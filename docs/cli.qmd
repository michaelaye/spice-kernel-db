---
title: "CLI Reference"
subtitle: "Command-line interface"
---

On first run, the tool prompts for configuration (database path and kernel storage directory). These are saved to `~/.config/spice-kernel-db/config.toml`. All commands share a `--db` option to override the configured database path.

## `scan`

Recursively scan a directory and register all kernel files.

```bash
spice-kernel-db scan <directory> [--mission NAME] [-v] [--archive]
```

| Option | Description |
|--------|-------------|
| `directory` | Root directory to scan recursively |
| `--mission` | Override auto-detected mission name |
| `-v, --verbose` | Print each registered file |
| `--archive` | Move files to the configured kernel directory and leave symlinks at the original locations |

```bash
# Auto-detect mission from path structure
spice-kernel-db scan /data/spice/JUICE/kernels

# Explicit mission label
spice-kernel-db scan /data/spice/generic_kernels --mission generic

# Verbose output
spice-kernel-db scan /data/spice/MRO/kernels -v

# Import kernels from a random directory into the central archive
spice-kernel-db scan /tmp/downloaded_kernels --mission JUICE --archive
```

With `--archive`, each kernel file is moved into the configured kernel directory (organized as `{kernel_dir}/{mission}/{type}/{filename}`) and a symlink is left at the original location. This lets you import kernels from anywhere while keeping the original paths functional.

::: {.callout-note}
Symlinks require filesystem support. On Windows, Developer Mode or administrator privileges are needed. If symlink creation fails, the file is still moved and registered — only the symlink is skipped (with a warning).
:::

## `stats`

Print database summary statistics.

```bash
spice-kernel-db stats
```

Shows unique kernels, total locations, total size, number of duplicates, registered missions, and a breakdown by kernel type.


## `duplicates`

Report all duplicated kernels.

```bash
spice-kernel-db duplicates
```

Lists each kernel that exists in 2+ locations, showing all paths and missions, with a total wasted space calculation.


## `check`

Check which kernels from a metakernel are available locally.

```bash
spice-kernel-db check <metakernel> [--mission NAME]
```

| Option | Description |
|--------|-------------|
| `metakernel` | Path to the `.tm` file |
| `--mission` | Mission name for preferred-mission resolution |

```bash
spice-kernel-db check juice_crema_5_1.tm --mission JUICE
```

Reports found/missing counts, lists missing files, and shows warnings for cross-mission fallbacks.


## `rewrite`

Rewrite a metakernel with a local symlink tree.

```bash
spice-kernel-db rewrite <metakernel> -o <output> [--link-root DIR] [--mission NAME]
```

| Option | Description |
|--------|-------------|
| `metakernel` | Path to original `.tm` file |
| `-o, --output` | Output `.tm` path (required) |
| `--link-root` | Root for symlink tree (default: `kernels/` next to output) |
| `--mission` | Mission name for preferred-mission resolution |

```bash
# Basic usage
spice-kernel-db rewrite juice_crema_5_1.tm -o juice_local.tm

# Custom symlink root
spice-kernel-db rewrite juice_crema_5_1.tm -o juice_local.tm \
    --link-root /data/spice/unified

# Explicit mission
spice-kernel-db rewrite juice_crema_5_1.tm -o juice_local.tm --mission JUICE
```


## `resolve`

Find the local path for a single kernel filename.

```bash
spice-kernel-db resolve <filename> [--mission NAME]
```

| Option | Description |
|--------|-------------|
| `filename` | Kernel filename to look up |
| `--mission` | Preferred mission for resolution |

```bash
spice-kernel-db resolve naif0012.tls --mission JUICE
# /data/spice/JUICE/kernels/lsk/naif0012.tls

spice-kernel-db resolve mro_sc_2024.bc --mission JUICE
# /data/spice/MRO/kernels/ck/mro_sc_2024.bc
#   ⚠ mro_sc_2024.bc: not found in [JUICE] registry, using copy from [MRO]
```

Prints the resolved path to stdout and any warnings to stderr.


## `dedup`

Replace duplicate kernel files with symlinks.

```bash
spice-kernel-db dedup [--execute]
```

| Option | Description |
|--------|-------------|
| `--execute` | Actually replace files (default: dry run) |

```bash
# Preview (default, safe)
spice-kernel-db dedup

# Do it
spice-kernel-db dedup --execute
```

The canonical copy (the file that symlinks point to) is chosen with a preference for files in the `generic` mission.


## `metakernels`

List tracked metakernels or show detailed info about a specific one.

```bash
spice-kernel-db metakernels [name] [--mission NAME]
```

| Option | Description |
|--------|-------------|
| `name` | Optional: show info for a specific metakernel (by filename) |
| `--mission` | Filter listing by mission name |

```bash
# List all tracked metakernels
spice-kernel-db metakernels

# Filter by mission
spice-kernel-db metakernels --mission JUICE

# Detailed info for a specific metakernel
spice-kernel-db metakernels juice_crema_5_1.tm
```

When no `name` is given, prints a summary table with kernel counts and availability. When a `name` is given, shows per-kernel status with type, size, and whether each kernel is in the database or missing.


## `acquire`

Fetch a remote metakernel, show which kernels are needed, and download missing ones.

```bash
spice-kernel-db acquire <url> [--download-dir DIR] [--mission NAME] [-y]
```

| Option | Description |
|--------|-------------|
| `url` | URL to a remote `.tm` metakernel |
| `--download-dir` | Override default kernel storage directory |
| `--mission` | Override auto-detected mission name |
| `-y, --yes` | Skip confirmation prompt |

```bash
# Interactive (shows table, prompts before downloading)
spice-kernel-db acquire https://naif.jpl.nasa.gov/pub/naif/JUICE/kernels/mk/juice_crema_5_1.tm

# Auto-confirm download
spice-kernel-db acquire https://naif.jpl.nasa.gov/pub/naif/JUICE/kernels/mk/juice_crema_5_1.tm -y

# Custom download directory
spice-kernel-db acquire https://naif.jpl.nasa.gov/pub/naif/JUICE/kernels/mk/juice_crema_5_1.tm \
    --download-dir /data/spice/juice

# Override mission name
spice-kernel-db acquire https://naif.jpl.nasa.gov/pub/naif/JUICE/kernels/mk/juice_crema_5_1.tm \
    --mission JUICE
```

The tool fetches the remote metakernel, resolves each kernel entry to a full URL, checks your local database, queries remote file sizes (in parallel), and displays a summary table. Downloaded kernels are stored preserving the remote subdirectory structure (e.g. `lsk/`, `spk/`, `ck/`) and automatically registered in the database.


## `config`

Show or update configuration.

```bash
spice-kernel-db config [--setup]
```

| Option | Description |
|--------|-------------|
| `--setup` | Re-run the interactive first-time setup |

```bash
# Show current settings
spice-kernel-db config

# Re-run setup (change database path, kernel directory, etc.)
spice-kernel-db config --setup
```

Without `--setup`, prints the current configuration: database path, kernel directory, and config file location.


## `reset`

Delete the database and start fresh.

```bash
spice-kernel-db reset [-y]
```

| Option | Description |
|--------|-------------|
| `-y, --yes` | Skip confirmation prompt |

```bash
# Interactive (asks for confirmation)
spice-kernel-db reset

# Skip confirmation
spice-kernel-db reset -y
```

Deletes only the DuckDB database file. Kernel files in the configured kernel directory are **not** touched. After resetting, you can re-index existing kernels:

```bash
spice-kernel-db scan ~/.local/share/spice-kernel-db/kernels
```
